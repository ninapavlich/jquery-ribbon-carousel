function SlideImage(a,b,c){this.has_image="undefined"!=typeof a,this.src=a,this.original_markup=b,this.index=c,this.loaded=!1,this.loading=!1,this.loading_error=!1,this.load_requested=!1,this.original_width=null,this.original_height=null,this.original_aspect_ratio=null,this.loader=$("<img />");var d=this;$(this.loader).bind("load",function(){d.original_width=this.width,d.original_height=this.height,d.original_aspect_ratio=this.width/this.height,d.load_completed()}),$(this.loader).bind("error",function(){d.load_error()})}!function(a,b,c,d){function e(b,c){this.element=b,a(this.element).data("ribbonCarousel",this),this.options=a.extend({},g,c),this.mobile_break=this.options.mobileBreak,this.average_aspect_ratio=null,this.calculateDimensions(),this.all_images=[],this.all_images_index_hash={},this.image_load_queue=[],this.loaded_images=[],this.loaded_images_index_hash={},this.starting_loading_index=null,this.current_index=null,this.previous_rendered_index=null,this.previous_rendered_queue=null,this.initial_values_inited=!1,this.containers_inited=!1,this.event_listeners_inited=!1,this.sufficiently_loaded=!1,this.rendering=!1,this.request_next_index=null,this.request_rerender=!1,this.original_slide_container=null,this.slide_container=null,this.autoplay_interval=null,this.autoplay_count=0,this.is_autoplaying=!1,this.draggable_inited=!1,this.is_dragging=!1,this.drag_direction=0,this.start_drag_position=null,this.start_drag_position_left=null,this.start_drag_position_right=null,this.stop_drag_position=null,this.stop_drag_position_left=null,this.stop_drag_position_right=null,this.drag_timeout=null,this.was_autoplaying=!1,this.drag_offset=0,this.init()}var f="ribbonCarousel",g={autoPlay:!1,autoPlayInterval:8e3,maxAutoPlayIntervals:1,useAnchors:!1,pageAnchorPrefix:"slide-",animationDuration:600,animationEase:"easeInOutQuart",themeClass:"ribbon-carousel-theme-default",initialUnloadedClass:"unloaded",slideWidth:null,slideHeight:null,aspectRatio:1.8,minimumLoad:1,initKeyboardEvents:!0,initDraggingEvents:!0,initUI:!0};e.prototype={init:function(){return 0==this.initial_values_inited&&(a(this.element).addClass("loading"),a(this.element).removeClass(this.options.initialUnloadedClass),a(this.element).trigger("loading"),a(this.element).addClass(this.options.themeClass),this.current_index=this.starting_loading_index=1==this.options.useAnchors?this.getIndexFromHash(b.location.hash):0,this.initial_values_inited=!0),0==this.containers_inited?(this.initContainers(),void this.resizeLoadingContainer()):0==this.event_listeners_inited?(this.initDraggable(),this.initUI(),this.initGlobalListeners(),void this.init()):0==this.sufficiently_loaded?void this.loadNextSlide():void this.renderSlides()},initContainers:function(){var b=this;if(1!=this.containers_inited){this.original_slide_container=a(this.element).find("ul")[0],a(this.original_slide_container).remove(),a(this.original_slide_container).children("li").each(function(c,d){var e=a(d).find("img")[0],f=new SlideImage(a(e).attr("src"),a(d).html(),c);b.all_images.push(f),b.all_images_index_hash[f.index]=f,a(e).removeAttr("src"),a(f).bind(SlideImage.EVENT_LOAD_COMPLETE,function(){b.loaded_images.push(f),b.loaded_images_index_hash[f.index]=f,b.average_aspect_ratio=b.calculateAverageAspectRatio(),b.loadNextSlide()}),a(f).bind(SlideImage.EVENT_LOAD_ERROR,function(){b.loadNextSlide()})}),this.image_load_queue=[];for(var c=this.all_images.length,d=Math.ceil(c/2),e=[],f=0;d>f;f++){var g=(f+this.starting_loading_index)%c;e.push(g),this.image_load_queue.push(this.all_images_index_hash[g]);var h=(c-(f+1)+this.starting_loading_index)%c;g!=h&&(this.image_load_queue.push(this.all_images_index_hash[h]),e.push(h))}this.slide_container=a("<div class='slide-container-inner' />"),a(this.element).append(this.slide_container),this.containers_inited=!0,this.init()}},initGlobalListeners:function(){if(1!=this.event_listeners_inited){var d=this;this.options.initKeyboardEvents&&a(c).bind("keydown",function(a){"37"==a.keyCode?d.goToPreviousSlide():"39"==a.keyCode&&d.goToNextSlide()}),a(b).bind("resize",function(){d.calculateDimensions(),d.resizeLoadingContainer(),1==d.sufficiently_loaded&&d.renderSlides(!1,0)}),a(b).bind("hashchange",function(){var a=d.getIndexFromHash(b.location.hash);d.current_index!=a&&d.setSlideIndex(a,"onHashChange")}),this.event_listeners_inited=!0}},loadNextSlide:function(){if(this.image_load_queue.length>0){var b=this.image_load_queue.shift();b.load()}else a(this.element).addClass("loaded"),a(this.element).removeClass("loading");this.loaded_images.length>=this.options.minimumLoad&&(0==this.sufficiently_loaded&&(this.resetAutoplay(),a(this.element).addClass("sufficiently-loaded")),this.sufficiently_loaded=!0,this.init())},setSlideIndex:function(c){if(this.rendering)return void(this.request_next_index=c);this.request_next_index=null;var d=this.sanitizeSlideIndex(c);this.current_index!=d&&(this.current_index=d,a(this).trigger("SLIDE_CHANGE_EVENT"),this.resetAutoplay(),this.pauseSlide(this.previous_rendered_index)),1==this.options.useAnchors&&(b.location.hash=this.options.pageAnchorPrefix+(this.current_index+1)),this.renderSlides()},sanitizeSlideIndex:function(a){return(a+this.all_images.length)%this.all_images.length},startAutoplay:function(){this.options.autoPlay=!0,this.resetAutoplay()},resetAutoplay:function(){var b=this;clearInterval(this.autoplay_interval),this.is_autoplaying=!1,this.autoplay_count=0,a(this.ui_container).find(".start").show(),a(this.ui_container).find(".stop").hide(),this.options.autoPlay?(this.autoplay_interval=setInterval(function(){b.autoplay_count+=1;var a=b.all_images.length*b.options.maxAutoPlayIntervals;0==a||a>=b.autoplay_count?b.goToNextSlide():b.stopAutoplay()},this.options.autoPlayInterval),this.is_autoplaying=!0,a(this.ui_container).find(".start").hide(),a(this.ui_container).find(".stop").show()):(a(this.ui_container).find(".start").show(),a(this.ui_container).find(".stop").hide())},stopAutoplay:function(){clearInterval(this.autoplay_interval),a(this.ui_container).find(".start").show(),a(this.ui_container).find(".stop").hide(),this.is_autoplaying=!1},goToNextSlide:function(){this.setSlideIndex(this.current_index+1,"goToNextSlide")},goToPreviousSlide:function(){this.setSlideIndex(this.current_index-1,"goToPreviousSlide")},getNextSlideIndex:function(){return this.sanitizeSlideIndex(this.current_index+1)},getPreviousSlideIndex:function(){return this.sanitizeSlideIndex(this.current_index-1)},resizeLoadingContainer:function(){if(this.sufficiently_loaded)a(this.element).css("min-height",0);else{a(this.element).css("min-height",this.slide_height);var c=a(b).width(),d=(c-this.slide_width)/2;a(this.slide_container).css("width",a(b).width()),a(this.slide_container).css("left",0-d)}},renderSlides:function(b,c){var e=this;if(typeof b==d&&(b=!1),typeof c==d&&(c=this.options.animationDuration),this.rendering)return void(this.request_rerender=!0);var f=this.previous_rendered_index!=this.current_index||1==b||0!=this.buffer_sides_change;if(f){this.request_rerender=!1,this.rendering=!0;var g=null==this.previous_rendered_queue?this.getIndexQueue(this.previous_rendered_index):this.previous_rendered_queue,h=this.getIndexQueue(this.current_index),i=this.previous_rendered_index-this.current_index,j=this.isBefore(this.current_index,this.previous_rendered_index),k=this.isFlipped(j,i),l=h.equals(g),m=l?[]:this.getSlideIndexesToAdd(g,h,i,k),n=l?[]:this.getIndexesToRemove(g,h,i,k,j);j&&m.reverse();var o=this.buffer_sides_change<0;if(o){for(var p=m.length/2-1;p>=0;p--){var q=m[p],r=this.all_images_index_hash[q],s=this.createSlide(r);a(this.slide_container).prepend(s)}for(var p=m.length/2;p<m.length;p++){var q=m[p],r=this.all_images_index_hash[q],s=this.createSlide(r);a(this.slide_container).append(s)}}else for(var p=0;p<m.length;p++){var q=m[p],r=this.all_images_index_hash[q],s=this.createSlide(r);j?a(this.slide_container).prepend(s):a(this.slide_container).append(s)}var t=this.getNextSlideIndex(),u=this.getPreviousSlideIndex();a(this.slide_container).children().each(function(b,c){var d=parseInt(a(c).attr("data-index"));a(c).removeClass("current"),a(c).removeClass("next"),a(c).removeClass("previous"),d==e.current_index?a(c).addClass("current"):d==t?a(c).addClass("next"):d==u&&a(c).addClass("previous")})}else var j=!1,n=[];if(j)var v=0-this.buffer_sides*this.slide_width-this.slide_width*n.length;else var v=0-this.buffer_sides*this.slide_width;if(v-=this.drag_offset,j)var w=0-this.buffer_sides*this.slide_width;else var w=0-this.buffer_sides*this.slide_width-this.slide_width*n.length;a(this.slide_container).css("left",v),this.resizeContainers(),a(this.slide_container).children().css("width",this.slide_width),v==w?e.renderSlidesComplete():a(this.slide_container).animate({left:w},c,this.options.animationEase,function(){e.renderSlidesComplete()})},renderSlidesComplete:function(){var b=this,c=(this.getIndexQueue(this.previous_rendered_index),this.getIndexQueue(this.current_index)),d=this.isBefore(this.current_index,this.previous_rendered_index),e=this.previous_rendered_index-this.current_index,f=this.isFlipped(d,e),g=e,h=[];a(this.slide_container).children().each(function(b,c){var d=parseInt(a(c).attr("data-index"));h.push(d)});var i=this.getIndexesToRemove(h,c,g,f,d);a(this.slide_container).children().each(function(c,d){var e=(parseInt(a(d).attr("data-index")),i.indexOf(c)>=0);e&&b.destroySlide(d)});var j=[];a(this.slide_container).children().each(function(b,c){var d=parseInt(a(c).attr("data-index"));j.push(d)}),this.previous_rendered_queue=j;var k=0-this.buffer_sides*this.slide_width;a(this.slide_container).css("left",k),this.previous_rendered_index=this.current_index,this.drag_offset=0,1==this.ui_inited&&(a(this.ui_container).find(".pagination a:not(:nth-child("+(this.current_index+1)+"))").removeClass("active"),a(this.ui_container).find(".pagination a:nth-child("+(this.current_index+1)+")").addClass("active")),this.rendering=!1,null!=this.request_next_index?this.setSlideIndex(this.request_next_index,"renderSlidesComplete - request_next_index"):1==this.request_rerender&&this.renderSlides(!0)},handleSlideClick:function(b,c){if(!this.is_dragging){var d=parseInt(a(c).attr("data-index"));console.log("slide index clicked: "+d),this.current_index!=d&&(b.preventDefault(),this.setSlideIndex(d,"handleSlideClick"))}},resizeContainers:function(){var b=this,c=this.getAspectRatio();a(this.element).css("height",this.slide_height);var d=a(this.slide_container).children().length;a(this.slide_container).css("width",this.slide_width*d),a(this.slide_container).children().each(function(d,e){a(e).css("width",b.slide_width),a(e).css("height",b.slide_height);var f=parseInt(a(e).attr("data-index")),g=b.all_images_index_hash[f];if(g.original_aspect_ratio>c){a(e).find("img").css("height",b.slide_height+"px"),a(e).find("img").css("width","auto"),a(e).find("img").attr("data-size","wider");var h=g.original_aspect_ratio*b.slide_height,i=-.5*(h-b.slide_width);a(e).find("img").css("left",i+"px")}else{a(e).find("img").css("height","auto"),a(e).find("img").css("width",b.slide_width+"px"),a(e).find("img").attr("data-size","taller");var j=b.slide_width/g.original_aspect_ratio,k=-.5*(j-b.slide_height);a(e).find("img").css("top",k+"px")}})},isBefore:function(){var a=this.all_images.length,b=Math.ceil(a/2),c=this.current_index-this.previous_rendered_index;return 0-b>=c?c=this.current_index+a-this.previous_rendered_index:c>b&&(c=this.current_index-(this.previous_rendered_index+a)),0>c?!0:!1},isFlipped:function(a,b){return 0==b?!1:0==a&&0>b?!1:1==a&&b>=0?!1:!0},getIndexesToRemove:function(a,b,c,d){var e=[];if(b.equals(a))return[];for(var f=b.length-a.length,g=0;g<a.length;g++){var h,i=(b[g],a[g]);if(d){var j=0>c?c+this.all_images.length:c-this.all_images.length;h=0>j?g+j:g+j+f}else 0>c?h=g+c:c>0?h=g+c+f:f>0&&this.buffer_sides_change<0?h=g+f/2:0>f&&this.buffer_sides_change>0?h=g+f/2:f>0&&(h=g);var k=h>=0&&h<b.length?b[h]:null;i!==k&&e.push(g)}return e},getSlideIndexesToAdd:function(a,b,c,d){var e=[];if(b.equals(a))return[];var f=b.length-a.length;if(d){var g=0>c?c+this.all_images.length:c-this.all_images.length;e=0>g?b.slice(g-f):b.slice(0,g+f)}else 0>c?e=b.slice(c-f):c>0?e=b.slice(0,c+f):f>0&&this.buffer_sides_change<0?e=b.slice(0,f/2).concat(b.slice(0-f/2)):0>f&&this.buffer_sides_change>0?e=[]:f>0&&(e=b.slice(0,f));return e},getIndexQueue:function(a){var b=[];if(null==a)return[];for(var c=a,d=this.all_images.length,e=this.buffer_sides-1;e>=0;e--){var f=this.sanitizeSlideIndex((d-1-e+c)%d);b.push(f)}b.push(c%d);for(var e=0;e<this.buffer_sides;e++){var g=this.sanitizeSlideIndex((c+e+1)%d);b.push(g)}return b},createSlide:function(b){var c=this,d=a(b.original_markup);return a(d).attr("data-index",b.index),a(d).bind("click",function(a){c.handleSlideClick(a,this)}),d},pauseSlide:function(b){var c=null;a(this.slide_container).children().each(function(d,e){var f=parseInt(a(e).attr("data-index"));f==b&&(c=e)}),a(c).find("iframe").length>0&&a(c).find("iframe").each(function(b,c){var d=a(c).attr("src");a(c).attr("src",""),a(c).attr("src",d)})},destroySlide:function(b){a(b).remove(),a(b).unbind("click")},getSlideIfAvailable:function(a){return a in this.loaded_images_index_hash?this.loaded_images_index_hash[a]:this.loaded_images[0]},getAspectRatio:function(){return this.aspect_ratio?this.aspect_ratio:this.average_aspect_ratio},getBufferSides:function(){return Math.ceil(a(b).width()/this.slide_width)},calculateDimensions:function(){this.options.slideWidth&&this.options.slideHeight?(this.slide_width=this.options.slideWidth,this.slide_height=this.options.slideHeight,this.aspect_ratio=this.options.slideWidth/this.options.slideHeight):this.options.slideWidth&&this.options.aspectRatio?(this.slide_width=this.options.slideWidth,this.aspect_ratio=this.options.aspectRatio,this.slide_height=this.options.slideWidth/this.options.aspectRatio):this.options.slideHeight&&this.options.aspectRatio?(this.aspect_ratio=this.options.aspectRatio,this.slide_height=this.options.slideHeight,this.options.slideWidth=this.options.slideHeight*this.options.aspectRatio):this.options.aspectRatio&&(this.slide_width=a(this.element).parent().width(),this.aspect_ratio=this.options.aspectRatio,this.slide_height=this.slide_width/this.aspect_ratio);var b=this.getBufferSides();this.buffer_sides_change=this.buffer_sides-b,this.buffer_sides=b},calculateAverageAspectRatio:function(){for(var a=0,b=this.loaded_images.length,c=0;b>c;c++){var d=this.loaded_images[c];a+=d.original_aspect_ratio}return a/b},getIndexFromHash:function(a){if("undefined"==typeof a&&(a=c.location.hash),""==a)return 0;var b=a.replace("#"+this.options.pageAnchorPrefix,""),d=parseInt(b);return isNaN(d)&&(d=0),d>0&&(d-=1),d},initUI:function(){var b=this;if(0!=this.options.initUI&&1!=this.ui_inited){this.ui_container=a('<div class="ui"><div class="arrows"></div><div class="autoplay"></div><div class="pagination"></div></div>'),this.ui_container.find(".arrows").html('<a href="#" class="next" title="Go to the next slide"><span>Next</span></a><a href="#" class="previous" title="Go to the previous slide"><span>Previous</span></a>'),this.ui_container.find(".autoplay").html('<a href="#" class="start" title="Start Autoplay"><span>Start</span></a><a href="#" class="stop" title="Stop Autoplay"><span>Stop</span></a>');for(var c=0;c<this.all_images.length;c++){var d=a('<a href="#'+this.options.pageAnchorPrefix+(c+1)+'" data-index="'+(c+1)+'" title="Go to slide '+(c+1)+'"><span>Slide '+(c+1)+"</span></a>");a(this.ui_container).find(".pagination").append(d)}a(this.ui_container).find(".next").bind("click",function(a){a.preventDefault(),b.goToNextSlide()}),a(this.ui_container).find(".previous").bind("click",function(a){a.preventDefault(),b.goToPreviousSlide()}),a(this.ui_container).find(".start").bind("click",function(a){a.preventDefault(),b.startAutoplay()}),a(this.ui_container).find(".stop").bind("click",function(a){a.preventDefault(),b.stopAutoplay()}),a(this.ui_container).find(".pagination a").bind("click",function(c){c.preventDefault();var d=parseInt(a(this).attr("data-index"));b.setSlideIndex(d-1)}),a(this.element).append(this.ui_container),this.ui_inited=!0}},initDraggable:function(){if(0!=this.options.initDraggingEvent&&1!=this.draggable_inited){try{a(this.slide_container).draggable("destroy")}catch(b){}a(this.slide_container).draggable({snap:!1,axis:"x"});var c=this;a(this.slide_container).bind("dragstart",function(){c.onDragStart()}),a(this.slide_container).bind("drag",function(){c.onDrag()}),a(this.slide_container).bind("dragstop",function(){c.onDragStop()}),this.draggable_inited=!0}},onDragStart:function(){this.was_autoplaying=this.is_autoplaying,this.stopAutoplay(),this.is_dragging=!0,this.start_drag_position=parseInt(a(this.slide_container).css("left")),this.drag_offset=0,clearTimeout(this.drag_timeout)},onDrag:function(){var b=parseInt(a(this.slide_container).css("left"));this.drag_offset=this.start_drag_position-b,this.drag_direction=Math.abs(this.drag_offset)/this.drag_offset},onDragStop:function(){var b=this.current_index;this.stop_drag_position=parseInt(a(this.slide_container).css("left"));var c=Math.ceil(Math.abs(this.start_drag_position-this.stop_drag_position)/this.slide_width);b=this.sanitizeSlideIndex(this.drag_direction>0?this.current_index+c:this.current_index-c),this.setSlideIndex(b,"onDragStop"),this.was_autoplaying&&this.startAutoplay();var d=this;this.drag_timeout=setTimeout(function(){d.is_dragging=!1},100)}},a.fn[f]=function(b){return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b))})}}(jQuery,window,document),SlideImage.EVENT_LOAD_STARTED="EVENT_LOAD_STARTED",SlideImage.EVENT_LOAD_COMPLETE="EVENT_LOAD_COMPLETE",SlideImage.EVENT_LOAD_ERROR="EVENT_LOAD_ERROR",SlideImage.prototype.load=function(){this.loading=!0,this.load_requested=!0,$(this).trigger(SlideImage.EVENT_LOAD_STARTED),this.has_image?$(this.loader).attr("src",this.src):(this.original_width=this.original_height=100,this.original_aspect_ratio=1,this.load_completed())},SlideImage.prototype.load_completed=function(){this.loading=!1,this.loaded=!0,$(this).trigger(SlideImage.EVENT_LOAD_COMPLETE)},SlideImage.prototype.load_error=function(){this.loading=!1,this.loading_error=!0,$(this).trigger(SlideImage.EVENT_LOAD_ERROR)},Array.prototype.equals&&console.warn("Overriding existing Array.prototype.equals. Possible causes: New API defines the method, there's a framework conflict or you've got double inclusions in your code."),Array.prototype.equals=function(a){if(!a)return!1;if(this.length!=a.length)return!1;for(var b=0,c=this.length;c>b;b++)if(this[b]instanceof Array&&a[b]instanceof Array){if(!this[b].equals(a[b]))return!1}else if(this[b]!=a[b])return!1;return!0},Object.defineProperty(Array.prototype,"equals",{enumerable:!1});