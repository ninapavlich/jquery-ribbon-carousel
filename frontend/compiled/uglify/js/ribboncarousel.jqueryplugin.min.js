function SlideImage(a,b,c){this.src=a,this.alt=b,this.index=c,this.loaded=!1,this.loading=!1,this.loading_error=!1,this.load_requested=!1,this.original_width=null,this.original_height=null,this.original_aspect_ratio=null,this.loader=$("<img />");var d=this;$(this.loader).bind("load",function(){d.original_width=this.width,d.original_height=this.height,d.original_aspect_ratio=this.width/this.height,d.load_completed()}),$(this.loader).bind("error",function(){d.load_error()})}!function(a,b,c,d){function e(c,d){this.element=c,a(this.element).data("ribbonCarousel",this),b.carousel=this,this.options=a.extend({},g,d),this.mobile_break=this.options.mobileBreak,this.average_aspect_ratio=null,this.calculateDimensions(),this.all_images=[],this.all_images_src_hash={},this.all_images_index_hash={},this.image_load_queue=[],this.loaded_images=[],this.loaded_images_src_hash={},this.loaded_images_index_hash={},this.starting_loading_index=null,this.current_index=null,this.previous_rendered_index=null,this.containers_inited=!1,this.event_listeners_inited=!1,this.sufficiently_loaded=!1,this.rendering=!1,this.request_next_index=null,this.request_rerender=!1,this.original_slide_container=null,this.slide_container=null,this.autoplay_interval=null,this.autoplay_count=0,this.init()}var f="ribbonCarousel",g={autoPlay:!1,autoPlayInterval:1e4,animationDuration:500,maxAutoPlayIntervals:1,useAnchors:!0,pageAnchorPrefix:"slide-",themeClass:"ribbon-carousel-theme-default",slideWidth:null,slideHeight:null,aspectRatio:1.8,minimumLoad:1,bufferSides:2,useKeyboardEvents:!0};e.prototype={init:function(){a(this.element).addClass("loading"),a(this.element).trigger("loading"),a(this.element).addClass(this.options.themeClass),this.current_index=this.starting_loading_index=1==this.options.useAnchors?this.getIndexFromHash(b.location.hash):0;return 0==this.containers_inited?void this.initContainers():0==this.event_listeners_inited?void this.initListeners():0==this.sufficiently_loaded?void this.loadNextSlide():void this.renderSlides()},initContainers:function(){var b=this;if(1!=this.containers_inited){this.original_slide_container=a(this.element).find("ul")[0],a(this.original_slide_container).remove(),a(this.original_slide_container).find("img").each(function(c){var d=new SlideImage(a(this).attr("src"),a(this).attr("alt"),c);a(this).removeAttr("src"),b.all_images.push(d),b.all_images_src_hash[d.src]=d,b.all_images_index_hash[d.index]=d,a(d).bind(SlideImage.EVENT_LOAD_COMPLETE,function(){b.loaded_images.push(d),b.loaded_images_src_hash[d.src]=d,b.loaded_images_index_hash[d.index]=d,b.average_aspect_ratio=b.calculateAverageAspectRatio(),b.loadNextSlide()}),a(d).bind(SlideImage.EVENT_LOAD_ERROR,function(){b.loadNextSlide()})}),this.image_load_queue=[];for(var c=this.all_images.length,d=Math.ceil(c/2),e=[],f=0;d>f;f++){var g=(f+this.starting_loading_index)%c;e.push(g),this.image_load_queue.push(this.all_images_index_hash[g]);var h=(c-(f+1)+this.starting_loading_index)%c;g!=h&&(this.image_load_queue.push(this.all_images_index_hash[h]),e.push(h))}this.slide_container=a("<div class='slide-container-inner' />"),a(this.element).append(this.slide_container),this.containers_inited=!0,this.init()}},initListeners:function(){var d=this;this.options.useKeyboardEvents&&a(c).bind("keydown",function(a){"37"==a.keyCode?d.goToPreviousSlide():"39"==a.keyCode&&d.goToNextSlide()}),a(b).bind("resize",function(){d.calculateDimensions(),d.renderSlides()}),a(b).bind("hashchange",function(){var a=d.getIndexFromHash(b.location.hash);d.current_index!=a&&d.setSlideIndex(a)}),this.event_listeners_inited=!0,this.init()},loadNextSlide:function(){if(this.image_load_queue.length>0){var b=this.image_load_queue.shift();b.load()}else a(this.element).removeClass("loading");this.loaded_images.length>=this.options.minimumLoad&&(0==this.sufficiently_loaded&&this.resetAutoplay(),this.sufficiently_loaded=!0,this.init())},setSlideIndex:function(c){if(this.rendering)return void(this.request_next_index=c);this.request_next_index=null;var d=c;d=(c+this.all_images.length)%this.all_images.length,this.current_index!=d&&(this.current_index=d,a(this).trigger("SLIDE_CHANGE_EVENT"),this.resetAutoplay()),1==this.options.useAnchors&&(b.location.hash=this.options.pageAnchorPrefix+(this.current_index+1)),this.renderSlides()},startAutoplay:function(){this.options.autoPlay=!0,this.resetAutoplay()},resetAutoplay:function(){var a=this;clearInterval(this.autoplay_interval),this.autoplay_count=0,this.options.autoPlay&&(this.autoplay_interval=setInterval(function(){a.autoplay_count+=1;var b=a.all_images.length*a.options.maxAutoPlayIntervals;0==b||b>=a.autoplay_count?a.goToNextSlide():a.stopAutoplay()},this.options.autoPlayInterval))},stopAutoplay:function(){clearInterval(this.autoplay_interval)},goToNextSlide:function(){this.setSlideIndex(this.current_index+1)},goToPreviousSlide:function(){this.setSlideIndex(this.current_index-1)},renderSlides:function(b){if(typeof b==d&&(b=!1),this.rendering)return void(this.request_rerender=!0);if(this.previous_rendered_index==this.current_index&&0==b)return void this.resizeContainers();this.request_rerender=!1,this.rendering=!0;var c=this,e=this.getIndexQueue(this.previous_rendered_index),f=this.getIndexQueue(this.current_index),g=this.getIndexesToAdd(e,f),h=this.getIndexesToRemove(e,f),i=this.isBefore(this.current_index,this.previous_rendered_index);if(i&&g.reverse(),i)var j=0-this.options.bufferSides*this.slide_width-this.slide_width*h.length;else var j=0-this.options.bufferSides*this.slide_width;if(i)var k=0-this.options.bufferSides*this.slide_width;else var k=0-this.options.bufferSides*this.slide_width-this.slide_width*h.length;for(var l=0;l<g.length;l++){var m=this.all_images_index_hash[g[l]],n=this.renderSlideHTML(m);i?a(this.slide_container).prepend(n):a(this.slide_container).append(n)}a(this.slide_container).css("left",j),this.resizeContainers(),a(this.slide_container).find("figure").css("width",this.slide_width),j==k?c.renderSlidesComplete():a(this.slide_container).animate({left:k},this.options.animationDuration,function(){c.renderSlidesComplete()})},renderSlidesComplete:function(){var b=this.getIndexQueue(this.previous_rendered_index),c=this.getIndexQueue(this.current_index),d=this.getIndexesToRemove(b,c);a(this.slide_container).find("figure").each(function(b,c){var e=parseInt(a(c).attr("data-index")),f=d.indexOf(e)>=0;f&&a(c).remove()});var e=0-this.options.bufferSides*this.slide_width;a(this.slide_container).css("left",e),this.previous_rendered_index=this.current_index,this.rendering=!1,null!=this.request_next_index?this.setSlideIndex(this.request_next_index):1==this.request_rerender&&this.renderSlides(!0)},resizeContainers:function(){var b=this,c=this.getAspectRatio();a(this.element).css("height",this.slide_height),a(this.slide_container).css("width",this.slide_width*this.all_images.length),a(this.slide_container).find("figure").each(function(d,e){a(e).css("width",this.slide_width),a(e).css("height",this.slide_height);var f=parseInt(a(e).attr("data-index")),g=b.all_images_index_hash[f];if(g.original_aspect_ratio>c){a(e).find("img").css("height",b.slide_height+"px"),a(e).find("img").css("width","auto"),a(e).find("img").attr("data-size","wider");var h=g.original_aspect_ratio*b.slide_height,i=-.5*(h-b.slide_width);a(e).find("img").css("left",i+"px")}else{a(e).find("img").css("height","auto"),a(e).find("img").css("width",b.slide_width+"px"),a(e).find("img").attr("data-size","taller");var j=b.slide_width/g.original_aspect_ratio,k=-.5*(j-b.slide_height);a(e).find("img").css("top",k+"px")}})},isBefore:function(){var a=this.all_images.length,b=Math.ceil(a/2),c=this.current_index-this.previous_rendered_index;return 0-b>=c?c=this.current_index+a-this.previous_rendered_index:c>=b&&(c=this.current_index-(this.previous_rendered_index+a)),0>c?!0:!1},getIndexesToRemove:function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];b.indexOf(e)<0&&c.push(e)}return c},getIndexesToAdd:function(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];a.indexOf(e)<0&&c.push(e)}return c},getIndexQueue:function(a){var b=[];if(null==a)return[];for(var c=a,d=this.all_images.length,e=this.options.bufferSides-1;e>=0;e--){var f=(d-1-e+c)%d;b.push(f)}b.push(c%d);for(var e=0;e<this.options.bufferSides;e++){var g=(c+e+1)%d;b.push(g)}return b},renderSlideHTML:function(a){return'<figure data-index="'+a.index+'"><img src="'+a.src+'" alt="'+a.alt+'" /><figcaption>'+a.alt+"</figcaption></figure>"},getSlideIfAvailable:function(a){return a in this.loaded_images_index_hash?this.loaded_images_index_hash[a]:this.loaded_images[0]},getAspectRatio:function(){return this.aspect_ratio?this.aspect_ratio:this.average_aspect_ratio},calculateDimensions:function(){this.options.slideWidth&&this.options.slideHeight?(this.slide_width=this.options.slideWidth,this.slide_height=this.options.slideHeight,this.aspect_ratio=this.options.slideWidth/this.options.slideHeight):this.options.slideWidth&&this.options.aspectRatio?(this.slide_width=this.options.slideWidth,this.aspect_ratio=this.options.aspectRatio,this.slide_height=this.options.slideWidth/this.options.aspectRatio):this.options.slideHeight&&this.options.aspectRatio?(this.aspect_ratio=this.options.aspectRatio,this.slide_height=this.options.slideHeight,this.options.slideWidth=this.options.slideHeight*this.options.aspectRatio):this.options.aspectRatio&&(this.slide_width=a(this.element).parent().width(),this.aspect_ratio=this.options.aspectRatio,this.slide_height=this.slide_width/this.aspect_ratio)},calculateAverageAspectRatio:function(){for(var a=0,b=this.loaded_images.length,c=0;b>c;c++){var d=this.loaded_images[c];a+=d.original_aspect_ratio}return a/b},getIndexFromHash:function(a){if("undefined"==typeof a&&(a=c.location.hash),""==a)return 0;var b=a.replace("#"+this.options.pageAnchorPrefix,""),d=parseInt(b);return isNaN(d)&&(d=0),d>0&&(d-=1),d}},a.fn[f]=function(b){return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b))})}}(jQuery,window,document),SlideImage.EVENT_LOAD_STARTED="EVENT_LOAD_STARTED",SlideImage.EVENT_LOAD_COMPLETE="EVENT_LOAD_COMPLETE",SlideImage.EVENT_LOAD_ERROR="EVENT_LOAD_ERROR",SlideImage.prototype.load=function(){this.loading=!0,this.load_requested=!0,$(this).trigger(SlideImage.EVENT_LOAD_STARTED),$(this.loader).attr("src",this.src)},SlideImage.prototype.load_completed=function(){this.loading=!1,this.loaded=!0,$(this).trigger(SlideImage.EVENT_LOAD_COMPLETE)},SlideImage.prototype.load_error=function(){this.loading=!1,this.loading_error=!0,$(this).trigger(SlideImage.EVENT_LOAD_ERROR)};