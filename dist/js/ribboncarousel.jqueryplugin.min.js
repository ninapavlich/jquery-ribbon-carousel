!function(a,b,c){function d(b,c){this.element=b,this.options=a.extend({},f,c),this.ready=!1,this.mobile_break=this.options.mobileBreak,this._defaults=f,this._name=e,this._original_slides=[],this.current_index=0,this.previous_index=0,this.previous_rendered_index=-1,this.dot_index=0,this.min_index=0,this.max_index=null,this.set_length=null,this.can_animate=!0,this.autoprogress_timeout=-1,this.slides_container=null,this.carousel_left=null,this.carousel_left_container=null,this.carousel_right=null,this.carousel_right_container=null,this.controls_container=null,this.carousel_pagination=null,this.carousel_arrows=null,this.init()}var e="ribbonCarousel",f={mobileBreak:767,autoPlay:!1,autoPlayDelay:15e3,autoPlayInterval:15e3,containerWidthPortion:1,usePageAnchors:!0,pageAnchorPrefix:"slide",themeClass:"ribbon-carousel-theme-default"};d.prototype={init:function(){var b=this,c=a(this.element).find("li");if(this.set_length=a(c).length,this.max_index=this.set_length-1,0==this.ready){var d=a(c).find("img[data-inited='true']");c.length==d.length?this.ready=!0:a(c).each(function(c,d){var e=a(d).find("img")[0],f=b.isImageMeasured(e);return 0==f?(b.measureImage(e),!1):void 0})}if(0!=this.ready){a(this.element).addClass("ready"),a(this.element).addClass(this.options.themeClass);var e=a(this.element).find("ul")[0];a('<div class="controls"><div class="container"></div></div>').insertBefore(e),this.controls_container=a(this.element).find(".controls > .container"),a('<div class="slides"><div class="container"></div></div>').insertBefore(e),this.slides_container=a(this.element).find(".slides > .container"),a(e).find("li").each(function(c,d){b._original_slides[c]=a(d).clone()}),a(e).css("display","none");var f="<ul class='carousel-arrows'><li><a href='#' class='next'><span>Next</span></a></li><li><a href='#' class='previous'><span>Previous</span></a></li></ul>",g="<ul class='carousel-pagination'>";a(c).each(function(a){g+="<li><a href='#"+b.options.pageAnchorPrefix+(a+1)+"'><span>Slide "+(a+1)+"</span></a></li>"}),g+="</ul>",a(this.controls_container).append(a(g+f)),a(this.slides_container).append(a("<div class='carousel-left-container'><ul class='carousel-left'></ul></div>")),a(this.slides_container).append(a("<div class='carousel-center-container'><ul class='carousel-center'></ul></div>")),a(this.slides_container).append(a("<div class='carousel-right-container'><ul class='carousel-right'></ul></div>")),this.carousel_left=a(this.slides_container).find("ul.carousel-left")[0],this.carousel_left_container=a(this.element).find(".carousel-left-container")[0],this.carousel_center=a(this.slides_container).find("ul.carousel-center")[0],this.carousel_center_container=a(this.element).find(".carousel-center-container")[0],this.carousel_right=a(this.slides_container).find("ul.carousel-right")[0],this.carousel_right_container=a(this.element).find(".carousel-right-container")[0],this.carousel_pagination=a(this.controls_container).find("ul.carousel-pagination")[0],this.carousel_arrows=a(this.controls_container).find(".carousel-arrows")[0];var h=this.getIndexFromHash();h&&(this.current_index=h),this.resizeImages(),this.addListeners(),this.setIndex(this.current_index)}},setIndex:function(a){if(0==this.can_animate)return void(this.next_index=a);if(this.previous_index=this.current_index,this.current_index=Math.max(Math.min(this.max_index,a),this.min_index),this.render(),1==this.options.autoPlay){var b=this;clearTimeout(this.autoprogress_timeout),this.autoprogress_timeout=setTimeout(function(){b.setIndex(b.getIndexAfter(b.current_index))},this.options.autoPlayInterval)}},getIndexFromHash:function(){var a=c.location.hash,b=a.replace("#"+this.options.pageAnchorPrefix,""),d=parseInt(b);return isNaN(d)&&(d=0),d>0&&(d-=1),d},render:function(){var b=this,c=this.getImageColumnWidth(),d=(this.getContainerWidth(),400),e=this.getCenterIndexes(this.current_index,this.set_length),f=this.getRelativeIndexes(this.current_index,this.previous_index,this.set_length),g=f[0],h=f[1],i=h>g,j=i?g:h,k=Math.floor(e.length/2),l=0-c*k,m=i?l+j*c:l-j*c,n=l-c,o=m-c,p=this.previous_rendered_index!=this.current_index;p?(this.setImages(e,this.carousel_center,!1),this.setImages(e,this.carousel_right,!1),this.setImages(e,this.carousel_left,!1),this.can_animate=!1,a(this.carousel_center).css("left",m+"px"),a(this.carousel_center).animate({left:l},d),a(this.carousel_right).css("left",o+"px"),a(this.carousel_right).animate({left:n},d),a(this.carousel_left).css("left",m+"px"),a(this.carousel_left).animate({left:l},d),this.can_animate=!1,setTimeout(function(){b.can_animate=!0},d+100),this.current_index!=this.previous_index&&a(this.carousel_pagination).find("li:nth-child("+(this.previous_index+1)+") a").removeClass("active"),a(this.carousel_pagination).find("li:nth-child("+(this.current_index+1)+") a").addClass("active"),this.reassignLinks(),this.resizeImages(),this.resizeContainers()):this.alignContainers(),this.previous_rendered_index=this.current_index},isImageMeasured:function(b){return a(b).data("inited")&&1==a(b).data("inited")?!0:"undefined"!=typeof a(b).data("image-width")&&"undefined"!=typeof a(b).data("image-width")?(a(b).data("inited",!0),!0):!1},measureImage:function(b){var c=this,d=c.isImageMeasured(b);0==d&&a("<img/>").attr("src",a(b).attr("src")).load(function(){a(b).data("inited",!0),a(b).attr("data-inited",!0),a(b).data("image-width",this.width),a(b).attr("data-image-width",this.width),a(b).data("image-height",this.height),a(b).attr("data-image-height",this.height),c.init()})},alignContainers:function(){var b=this.getImageColumnWidth(),c=2*this.set_length-1,d=Math.floor(c/2),e=0-b*d,f=e-b;a(this.carousel_center).css("left",e+"px"),a(this.carousel_right).css("left",f+"px"),a(this.carousel_left).css("left",e+"px")},resizeContainers:function(){var b=this.getImageColumnWidth(),c=2*this.set_length-1,d=this.set_length*b,e=c*b;console.log("LEFT? "+d+" center_right? "+e+" columnWidth? "+b),a(this.carousel_left).css("width",d),a(this.carousel_right).css("width",e),a(this.carousel_center).css("width",e)},resizeImages:function(){var b=this.getImageColumnWidth();a(this.element).find("ul.carousel-left > li").each(function(){a(this).width(b)}),a(this.element).find("ul.carousel-center > li").each(function(){a(this).width(b)}),a(this.element).find("ul.carousel-right > li").each(function(){a(this).width(b)}),this.resizeImageSet(a(this.element).find("ul.carousel-center > li, ul.carousel-left > li, ul.carousel-right > li"))},resizeImageSet:function(b){var c=this;a(b).each(function(){var b=a(this).find("img"),d=a(b).data("image-width"),e=a(b).data("image-height"),f=a(this).outerWidth(),g=a(this).outerHeight();c.imageFill(b,f,g,d,e)})},imageFill:function(b,c,d,e,f){var g=c/e,h=d/f;if(h>g){a(b).css("width","auto"),a(b).css("height",d+"px");var i=-.5*(e*h-c);a(b).css("margin-left",i+"px"),a(b).css("margin-top","0px")}else{a(b).css("height","auto"),a(b).css("width",c+"px");var j=-.5*(f*g-d);a(b).css("margin-top",j+"px"),a(b).css("margin-left","0px")}},getCenterIndexes:function(a,b){return this.getBeforeImageSet(a,b).concat([a]).concat(this.getAfterImageSet(a,b))},getAfterImageSet:function(a,b){for(var c=(a+1)%b,d=[],e=c;c+b-1>e;e++){var f=e%b;d.push(f)}return d},getBeforeImageSet:function(a,b){for(var c=(Math.floor((a+b)%b)+1)%b,d=[],e=c;c+b-1>e;e++){var f=e%b;d.push(f)}return d},reassignLinks:function(){var b=(this.current_index+1)%this.set_length,c=(this.current_index+this.set_length-1)%this.set_length,d="#"+this.options.pageAnchorPrefix+(b+1),e="#"+this.options.pageAnchorPrefix+(c+1);a(this.carousel_arrows).find(".next").attr("href",d),a(this.carousel_arrows).find(".previous").attr("href",e)},addListeners:function(){var c=this;a(this.element).find("li.next a").bind("click",function(a){a.preventDefault(),a.defaultPrevented;var b=(c.current_index+1)%c.set_length;c.setIndex(b)}),a(this.element).find("li.prev a").bind("click",function(a){a.preventDefault();var b=(c.current_index-1+c.set_length)%c.set_length;c.setIndex(b)}),a(this.element).find(".progress li").bind("click",function(b){b.preventDefault();var d=a(this).index();c.setIndex(d)}),a(b).bind("resize",function(){c.resizeImages(),c.resizeContainers(),c.alignContainers()}),a(b).bind("hashchange",function(){var a=c.getIndexFromHash();c.setIndex(a)})},addSlideListeners:function(c){a(c).attr("data-slide");a(c).find("a").bind("click",function(c){var d=c.target;"IMG"==c.target.tagName.toUpperCase()&&(d=a(d).parent()),b.location.href=a(d).attr("href")})},removeListeners:function(){a(this.element).find("li.next a").unbind("click"),a(this.element).find("li.prev a").unbind("click"),a(this.element).find(".progress li").unbind("click")},removeSlideListeners:function(b){a(b).find("a").unbind("click")},getImageColumnWidth:function(){var c=a(b).width();if(c<=this.mobile_break)return c;var d=a(this.slides_container).outerWidth();return d*this.options.containerWidthPortion},getContainerWidth:function(){var b=a(this.slides_container).outerWidth();return b},setImages:function(b,c,d){d&&console.log("indexes "+b);var e=this;a(c).children().each(function(a,b){e.removeSlide(b)});for(var f=0;f<b.length;f++)index=b[f],e.createSlide(index,c)},createSlide:function(b,c){var d=this._original_slides[b].clone();a(d).attr("data-slide",b),this.addSlideListeners(d),a(c).append(d)},removeSlide:function(b){this.removeSlideListeners(b),a(b).remove()},getRelativeIndexes:function(a,b,c){var d=Math.abs(b-a)%c,e=Math.abs(b+c-a)%c,f=Math.abs(b-(c+a))%c,g=(Math.abs(a-b)%c,Math.abs(c-(a-b))%c,a>=b?d:f),h=a>=b?e:e;return[g,h]},getIndexAfter:function(a){return(a+1)%this.set_length},getIndexBefore:function(a){return(a+this.set_length-1)%this.set_length}},a.fn[e]=function(b){return this.each(function(){a.data(this,"plugin_"+e)||a.data(this,"plugin_"+e,new d(this,b))})}}(jQuery,window,document);